<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Эффект памяти формы</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #191932;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #sketch-container {
            position: relative;
        }
        #controls {
            position: absolute;
            bottom: 15px;
            left: 0;
            right: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        #controls label {
            color: #999;
            font-family: Arial, sans-serif;
            font-size: 14px;
        }
        #controls input[type="range"] {
            width: 150px;
        }
        #controls button {
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background: #444;
            color: white;
        }
        #controls button:hover {
            background: #555;
        }
        .temp-label {
            color: #666;
            font-size: 12px;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div id="sketch-container">
        <div id="controls">
            <label>Температура:</label>
            <span class="temp-label">-50°C</span>
            <input type="range" id="tempSlider" min="-50" max="150" value="100">
            <span class="temp-label">150°C</span>
            <button id="btnDeform">Деформировать</button>
            <button id="btnReset">Сбросить</button>
        </div>
    </div>

<script>
// ============================================
// ЭФФЕКТ ПАМЯТИ ФОРМЫ
// Визуализация мартенситного превращения
// ============================================

// --- МАССИВЫ ---
let atoms = [];
let bonds = [];
let startPositions = [];

// --- ПАРАМЕТРЫ ---
let cols = 10;
let rows = 6;
let atomSize = 16;
let spacing = 55;

// --- ТЕМПЕРАТУРЫ ---
let Ms = 30;
let Af = 80;

// --- СОСТОЯНИЕ ---
let temperature = 100;
let phase = "аустенит";
let isDeformed = false;


function setup() {
  let canvas = createCanvas(800, 500);
  canvas.parent('sketch-container');
  
  // Привязка кнопок
  document.getElementById('btnDeform').addEventListener('click', deform);
  document.getElementById('btnReset').addEventListener('click', reset);
  
  createLattice();
}


function createLattice() {
  atoms = [];
  bonds = [];
  startPositions = [];
  
  let startX = (width - (cols - 1) * spacing) / 2;
  let startY = (height - 80 - (rows - 1) * spacing) / 2;
  
  for (let i = 0; i < rows; i++) {
    for (let j = 0; j < cols; j++) {
      let x = startX + j * spacing;
      let y = startY + i * spacing;
      
      atoms.push({
        x: x,
        y: y,
        targetX: x,
        targetY: y,
        row: i
      });
      
      startPositions.push({x: x, y: y});
    }
  }
  
  for (let i = 0; i < atoms.length; i++) {
    let row = Math.floor(i / cols);
    let col = i % cols;
    
    if (col < cols - 1) {
      bonds.push({from: i, to: i + 1});
    }
    if (row < rows - 1) {
      bonds.push({from: i, to: i + cols});
    }
  }
  
  isDeformed = false;
}


function draw() {
  background(25, 25, 45);
  
  // Читаем температуру из слайдера
  temperature = parseInt(document.getElementById('tempSlider').value);
  
  if (temperature < Ms) {
    phase = "мартенсит";
  } else if (temperature > Af) {
    phase = "аустенит";
  } else {
    phase = "переход";
  }
  
  if (phase === "аустенит" && isDeformed) {
    restoreShape();
  }
  
  moveAtoms();
  drawBonds();
  drawAtoms();
  drawInterface();
}


function moveAtoms() {
  for (let i = 0; i < atoms.length; i++) {
    atoms[i].x = lerp(atoms[i].x, atoms[i].targetX, 0.1);
    atoms[i].y = lerp(atoms[i].y, atoms[i].targetY, 0.1);
  }
}


function restoreShape() {
  for (let i = 0; i < atoms.length; i++) {
    atoms[i].targetX = startPositions[i].x;
    atoms[i].targetY = startPositions[i].y;
  }
  
  let done = true;
  for (let i = 0; i < atoms.length; i++) {
    let d = dist(atoms[i].x, atoms[i].y, startPositions[i].x, startPositions[i].y);
    if (d > 2) {
      done = false;
      break;
    }
  }
  
  if (done) {
    isDeformed = false;
  }
}


function deform() {
  if (phase !== "мартенсит") {
    return;
  }
  
  isDeformed = true;
  
  for (let i = 0; i < atoms.length; i++) {
    let row = atoms[i].row;
    let shiftX = row * 15 + random(-5, 5);
    let shiftY = random(-4, 4);
    
    atoms[i].targetX = startPositions[i].x + shiftX;
    atoms[i].targetY = startPositions[i].y + shiftY;
  }
}


function reset() {
  document.getElementById('tempSlider').value = 100;
  temperature = 100;
  createLattice();
}


function drawBonds() {
  for (let i = 0; i < bonds.length; i++) {
    let a = atoms[bonds[i].from];
    let b = atoms[bonds[i].to];
    
    let len = dist(a.x, a.y, b.x, b.y);
    let diff = abs(len - spacing);
    
    if (diff > 5) {
      stroke(255, 100, 100);
      strokeWeight(2);
    } else {
      stroke(255, 255, 255, 100);
      strokeWeight(1);
    }
    
    line(a.x, a.y, b.x, b.y);
  }
}


function drawAtoms() {
  for (let i = 0; i < atoms.length; i++) {
    if (phase === "аустенит") {
      fill(46, 204, 113);
    } else if (phase === "мартенсит") {
      fill(52, 152, 219);
    } else {
      fill(241, 196, 15);
    }
    
    noStroke();
    ellipse(atoms[i].x, atoms[i].y, atomSize, atomSize);
  }
}


function drawInterface() {
  fill(255);
  textSize(20);
  textAlign(LEFT);
  text("Эффект памяти формы", 20, 30);
  
  textSize(14);
  fill(255);
  text("T = " + temperature + "°C", 20, 55);
  
  if (phase === "аустенит") {
    fill(46, 204, 113);
  } else if (phase === "мартенсит") {
    fill(52, 152, 219);
  } else {
    fill(241, 196, 15);
  }
  text("Фаза: " + phase, 120, 55);
  
  if (isDeformed) {
    fill(255, 100, 100);
    text("● деформирован", 250, 55);
  }
}
</script>
</body>
</html>
